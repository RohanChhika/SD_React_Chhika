{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useAuth0}from'@auth0/auth0-react';import{Fragment as _Fragment,jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Profile=()=>{const{user,isAuthenticated,isLoading,getAccessTokenSilently}=useAuth0();const[userInfo,setUserInfo]=useState(null);// Move the conditional check inside the useEffect\nuseEffect(()=>{// Only execute the code inside the useEffect if isAuthenticated is true\nif(isAuthenticated){const fetchUserData=async()=>{try{const token=await getAccessTokenSilently();// Get the Auth0 access token\nconst response=await fetch('https://fundit.azurewebsites.net/login',{method:'POST',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify({userID:user.sub})});if(!response.ok){throw new Error(\"HTTP error! status: \".concat(response.status));}const data=await response.json();setUserInfo(data);}catch(error){console.error('Failed to fetch user data:',error);}};fetchUserData();}},[isAuthenticated,getAccessTokenSilently,user===null||user===void 0?void 0:user.email]);// Dependencies remain the same\nif(isLoading){return/*#__PURE__*/_jsx(_Fragment,{children:\"Loading...\"});}if(!isAuthenticated){return/*#__PURE__*/_jsx(_Fragment,{children:\"Please log in\"});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{children:user.nickname}),/*#__PURE__*/_jsx(\"p\",{children:user.email}),/*#__PURE__*/_jsxs(\"p\",{children:[\"User ID: \",user.sub]}),userInfo&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Role: \",userInfo.role]})})]});};export default Profile;","map":{"version":3,"names":["React","useState","useEffect","useAuth0","Fragment","_Fragment","jsx","_jsx","jsxs","_jsxs","Profile","user","isAuthenticated","isLoading","getAccessTokenSilently","userInfo","setUserInfo","fetchUserData","token","response","fetch","method","headers","concat","body","JSON","stringify","userID","sub","ok","Error","status","data","json","error","console","email","children","nickname","role"],"sources":["C:/Users/Rohan/Documents/Sofware Design/Project/SD_React_Chhika/src/components/profile.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useAuth0 } from '@auth0/auth0-react';\r\n\r\nconst Profile = () => {\r\n  const { user, isAuthenticated, isLoading, getAccessTokenSilently } = useAuth0();\r\n  const [userInfo, setUserInfo] = useState(null);\r\n\r\n  // Move the conditional check inside the useEffect\r\n  useEffect(() => {\r\n    // Only execute the code inside the useEffect if isAuthenticated is true\r\n    if (isAuthenticated) {\r\n      const fetchUserData = async () => {\r\n        try {\r\n          const token = await getAccessTokenSilently(); // Get the Auth0 access token\r\n          const response = await fetch('https://fundit.azurewebsites.net/login', {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n              'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n              userID: user.sub\r\n            })\r\n          });\r\n\r\n          if (!response.ok) {\r\n            throw new Error(`HTTP error! status: ${response.status}`);\r\n          }\r\n\r\n          const data = await response.json();\r\n          setUserInfo(data);\r\n        } catch (error) {\r\n          console.error('Failed to fetch user data:', error);\r\n        }\r\n      };\r\n\r\n      fetchUserData();\r\n    }\r\n  }, [isAuthenticated, getAccessTokenSilently, user?.email]);  // Dependencies remain the same\r\n\r\n  if (isLoading) {\r\n    return <>Loading...</>;\r\n  }\r\n\r\n  if (!isAuthenticated) {\r\n    return <>Please log in</>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <p>{user.nickname}</p>\r\n      <p>{user.email}</p>\r\n      <p>User ID: {user.sub}</p>\r\n      {userInfo && (\r\n        <>\r\n          <p>Role: {userInfo.role}</p>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Profile;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,QAAQ,KAAQ,oBAAoB,CAAC,OAAAC,QAAA,IAAAC,SAAA,CAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE9C,KAAM,CAAAC,OAAO,CAAGA,CAAA,GAAM,CACpB,KAAM,CAAEC,IAAI,CAAEC,eAAe,CAAEC,SAAS,CAAEC,sBAAuB,CAAC,CAAGX,QAAQ,CAAC,CAAC,CAC/E,KAAM,CAACY,QAAQ,CAAEC,WAAW,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CAE9C;AACAC,SAAS,CAAC,IAAM,CACd;AACA,GAAIU,eAAe,CAAE,CACnB,KAAM,CAAAK,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChC,GAAI,CACF,KAAM,CAAAC,KAAK,CAAG,KAAM,CAAAJ,sBAAsB,CAAC,CAAC,CAAE;AAC9C,KAAM,CAAAK,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,wCAAwC,CAAE,CACrEC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAAkB,CAClC,eAAe,WAAAC,MAAA,CAAYL,KAAK,CAClC,CAAC,CACDM,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBC,MAAM,CAAEhB,IAAI,CAACiB,GACf,CAAC,CACH,CAAC,CAAC,CAEF,GAAI,CAACT,QAAQ,CAACU,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAC,KAAK,wBAAAP,MAAA,CAAwBJ,QAAQ,CAACY,MAAM,CAAE,CAAC,CAC3D,CAEA,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAb,QAAQ,CAACc,IAAI,CAAC,CAAC,CAClCjB,WAAW,CAACgB,IAAI,CAAC,CACnB,CAAE,MAAOE,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,CAAEA,KAAK,CAAC,CACpD,CACF,CAAC,CAEDjB,aAAa,CAAC,CAAC,CACjB,CACF,CAAC,CAAE,CAACL,eAAe,CAAEE,sBAAsB,CAAEH,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEyB,KAAK,CAAC,CAAC,CAAG;AAE7D,GAAIvB,SAAS,CAAE,CACb,mBAAON,IAAA,CAAAF,SAAA,EAAAgC,QAAA,CAAE,YAAU,CAAE,CAAC,CACxB,CAEA,GAAI,CAACzB,eAAe,CAAE,CACpB,mBAAOL,IAAA,CAAAF,SAAA,EAAAgC,QAAA,CAAE,eAAa,CAAE,CAAC,CAC3B,CAEA,mBACE5B,KAAA,CAAAJ,SAAA,EAAAgC,QAAA,eACA9B,IAAA,MAAA8B,QAAA,CAAI1B,IAAI,CAAC2B,QAAQ,CAAI,CAAC,cACpB/B,IAAA,MAAA8B,QAAA,CAAI1B,IAAI,CAACyB,KAAK,CAAI,CAAC,cACnB3B,KAAA,MAAA4B,QAAA,EAAG,WAAS,CAAC1B,IAAI,CAACiB,GAAG,EAAI,CAAC,CACzBb,QAAQ,eACPR,IAAA,CAAAF,SAAA,EAAAgC,QAAA,cACE5B,KAAA,MAAA4B,QAAA,EAAG,QAAM,CAACtB,QAAQ,CAACwB,IAAI,EAAI,CAAC,CAC5B,CACH,EACD,CAAC,CAEP,CAAC,CAED,cAAe,CAAA7B,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}